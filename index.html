<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ultra Wash Appointment Form</title>
<style>
:root {
  --font-family: 'Open Sans', sans-serif;
  --font-size-label: 14px;
  --font-size-input: 14px;
  --font-size-header: 22px;
  --color-background: #f6f7fa;
  --color-card-bg: #ffffff;
  --color-card-border: #dbdfe7;
  --color-card-shadow: rgba(99, 77, 255, 0.06);
  --color-header: #333;
  --color-label: #555;
  --color-input-border: #ccc;
  --color-input-text: #333;
  --color-focus-border: #5a4cc2;
  --color-btn-bg: #ff6d5a;
  --color-btn-text: #fff;
  --radius: 6px;
  --container-width: 440px;
}

body {
  font-family: var(--font-family);
  background-color: var(--color-background);
  display: flex;
  justify-content: center;
  padding: 32px;
}

form {
  background: var(--color-card-bg);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px var(--color-card-shadow);
  padding: 24px;
  width: var(--container-width);
}

h1 {
  text-align: center;
  font-size: var(--font-size-header);
  color: var(--color-header);
  margin-bottom: 24px;
}

label {
  display: block;
  margin-bottom: 6px;
  font-weight: 600;
  font-size: var(--font-size-label);
}

input[type="text"],
input[type="tel"],
input[type="datetime-local"],
textarea,
select {
  width: 100%;
  padding: 10px;
  font-size: var(--font-size-input);
  border: 1px solid var(--color-input-border);
  border-radius: var(--radius);
  margin-bottom: 16px;
  box-sizing: border-box;
}

input:focus,
textarea:focus,
select:focus {
  outline: none;
  border-color: var(--color-focus-border);
  box-shadow: 0 0 4px var(--color-focus-border);
}

textarea {
  resize: vertical;
}

button[type="submit"],
#getLocationBtn,
#getPickupLocationBtn,
#getDeliveryLocationBtn {
  background-color: var(--color-btn-bg);
  color: var(--color-btn-text);
  border: none;
  padding: 12px;
  width: 100%;
  border-radius: var(--radius);
  font-weight: 600;
  font-size: var(--font-size-input);
  cursor: pointer;
  margin-bottom: 16px;
}

#getLocationBtn,
#getPickupLocationBtn,
#getDeliveryLocationBtn {
  margin-bottom: 0;
}

button[type="submit"]:hover,
#getLocationBtn:hover,
#getPickupLocationBtn:hover,
#getDeliveryLocationBtn:hover {
  background-color: #e05343;
}

#locationStatus,
#pickupLocationStatus,
#deliveryLocationStatus {
  font-size: 13px;
  color: #555;
  margin-bottom: 12px;
  min-height: 18px;
}

.description {
  font-size: 13px;
  color: #555;
  margin-bottom: 16px;
  line-height: 1.4;
}

.note {
  font-size: 13px;
  color: #555;
  margin: 4px 0 16px 0;
  line-height: 1.4;
}

.small-checkbox-label {
  font-size: 13px;
  margin-left: 4px;
}

input.invalid {
  border-color: red;
}

#thankYouPopup {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: rgba(0,0,0,0.5);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
#thankYouPopup .popup-content {
  background: white;
  border-radius: 12px;
  padding: 24px 16px;
  max-width: 320px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}
#thankYouPopup .checkmark {
  font-size: 48px;
  color: #4CAF50;
  margin-bottom: 16px;
}
#thankYouPopup h1 {
  font-size: 20px;
  margin-bottom: 12px;
  color: #222;
}
#thankYouPopup p {
  font-size: 15px;
  color: #555;
  line-height: 1.6;
  margin: 0;
}
#thankYouPopup button {
  margin-top: 20px;
  background-color: #ff6d5a;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
}
</style>
</head>
<body>

<form id="appointmentForm" method="POST" action="https://risetotop.app.n8n.cloud/webhook-test/uw-admin" novalidate>
  <h1>Ultra Wash Appointment</h1>

  <label for="name">Full Name</label>
  <input id="name" name="name" type="text" placeholder="First Name, Last Name" required />

  <label for="phone">Phone Number</label>
  <input id="phone" name="phone" type="tel" placeholder="+673 8221133 / 8221133" required />

  <label for="service">Service</label>
  <select id="service" name="service" required>
    <option value="" disabled selected>Select service</option>
    <option value="Pick Up Only">Pick Up Only</option>
    <option value="Delivery Only">Delivery Only</option>
    <option value="Pick Up & Delivery">Pick Up & Delivery</option>
  </select>

  <div id="serviceFields" style="display:none;">

    <div id="singleAddressSection" style="display:none;">
      <label id="singleAddressLabel">Address</label>
      <div class="description" id="singleAddressDesc">
        Allow location access when prompted. If previously denied, please enable permissions in your device settings:<br><br>
        <strong>Android:</strong> Settings &gt; Apps &gt; Your Browser &gt; Permissions &gt; Location<br>
        <strong>iOS:</strong> Settings &gt; Privacy &gt; Location Services &gt; Your Browser<br><br>
        Then click <strong>‚ÄúSend My Exact Location‚Äù</strong> to share your coordinates.
      </div>
      <textarea id="singleAddress" name="singleAddress" placeholder="Enter your Address" rows="3"></textarea>
      <button type="button" id="getLocationBtn">üìç Send My Exact Location</button>
      <div id="locationStatus"></div>

      <label id="singleDateLabel">Date & Time</label>
      <div class="note" id="singleDateNote"></div>
      <input type="datetime-local" id="singleDateTime" name="singleDateTime" />
    </div>

    <div id="pickUpDeliverySection" style="display:none;">

      <label>Pick Up Location</label>
      <div class="description">
        Please provide the address where we can pick up your laundry.<br><br>
        Allow location access when prompted. If previously denied, please enable permissions in your device settings:<br><br>
        <strong>Android:</strong> Settings &gt; Apps &gt; Your Browser &gt; Permissions &gt; Location<br>
        <strong>iOS:</strong> Settings &gt; Privacy &gt; Location Services &gt; Your Browser<br><br>
        Then click <strong>‚ÄúSend My Exact Location‚Äù</strong> to share your coordinates.
      </div>
      <textarea id="pickupAddress" name="pickupAddress" placeholder="Enter your Address" rows="3"></textarea>
      <button type="button" id="getPickupLocationBtn">üìç Send My Exact Location</button>
      <div id="pickupLocationStatus"></div>

      <label>Pick Up Date & Time</label>
      <div class="note">
        ‚è∞ Pick Up hours:<br>
        ‚Ä¢ Monday‚ÄìFriday: 08:30 AM ‚Äì 04:30 PM<br>
        ‚Ä¢ Saturday: 08:30 AM ‚Äì 11:30 AM<br>
        ‚Ä¢ Sunday: Closed
      </div>
      <input type="datetime-local" id="pickupDate" name="pickupDate" />

      <label>Delivery Location</label>
      <div class="description">
        Enter your delivery address or use the same as pick up.
      </div>
      <input type="checkbox" id="sameAsPickup"> <span class="small-checkbox-label">Delivery address same as Pickup</span>
      <textarea id="deliveryAddress" name="deliveryAddress" placeholder="Enter your Address" rows="3" style="display:none;"></textarea>
      <button type="button" id="getDeliveryLocationBtn" style="display:none;">üìç Send My Exact Location</button>
      <div id="deliveryLocationStatus"></div>

      <div id="deliveryDateSection" style="display:none;">
        <label>Delivery Date & Time</label>
        <div class="note">
          ‚è∞ Delivery hours:<br>
          ‚Ä¢ Monday‚ÄìFriday: 08:30 AM ‚Äì 04:30 PM<br>
          ‚Ä¢ Saturday: 08:30 AM ‚Äì 11:30 AM<br>
          ‚Ä¢ Sunday: Closed
        </div>
        <input type="datetime-local" id="deliveryDate" name="deliveryDate" />
      </div>

    </div>

  </div>

  <button type="submit">Submit</button>
</form>

<div id="thankYouPopup">
  <div class="popup-content">
    <div class="checkmark">‚úÖ</div>
    <h1>Thank you for choosing UltraWash!</h1>
    <p>Your appointment has been successfully submitted.<br>
    Our team will contact you shortly via WhatsApp.</p>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>
const serviceSelect = document.getElementById('service');
const serviceFields = document.getElementById('serviceFields');
const singleAddressSection = document.getElementById('singleAddressSection');
const pickUpDeliverySection = document.getElementById('pickUpDeliverySection');
const sameAsPickup = document.getElementById('sameAsPickup');
const deliveryAddress = document.getElementById('deliveryAddress');

const getLocationBtn = document.getElementById('getLocationBtn');
const locationStatus = document.getElementById('locationStatus');
const getPickupLocationBtn = document.getElementById('getPickupLocationBtn');
const pickupLocationStatus = document.getElementById('pickupLocationStatus');
const getDeliveryLocationBtn = document.getElementById('getDeliveryLocationBtn');
const deliveryLocationStatus = document.getElementById('deliveryLocationStatus');

// Show/hide fields based on service
serviceSelect.addEventListener('change', () => {
  serviceFields.style.display = 'block';
  if(serviceSelect.value === 'Pick Up Only'){
    singleAddressSection.style.display = 'block';
    pickUpDeliverySection.style.display = 'none';
    document.getElementById('singleDateLabel').textContent = 'Pick Up Date & Time';
    document.getElementById('singleDateNote').innerHTML = `‚è∞ Pick Up hours:<br>‚Ä¢ Monday‚ÄìFriday: 08:30 AM ‚Äì 04:30 PM<br>‚Ä¢ Saturday: 08:30 AM ‚Äì 11:30 AM<br>‚Ä¢ Sunday: Closed`;
  } else if(serviceSelect.value === 'Delivery Only'){
    singleAddressSection.style.display = 'block';
    pickUpDeliverySection.style.display = 'none';
    document.getElementById('singleDateLabel').textContent = 'Delivery Date & Time';
    document.getElementById('singleDateNote').innerHTML = `‚è∞ Delivery hours:<br>‚Ä¢ Monday‚ÄìFriday: 08:30 AM ‚Äì 04:30 PM<br>‚Ä¢ Saturday: 08:30 AM ‚Äì 11:30 AM<br>‚Ä¢ Sunday: Closed`;
  } else if(serviceSelect.value === 'Pick Up & Delivery'){
    singleAddressSection.style.display = 'none';
    pickUpDeliverySection.style.display = 'block';
    sameAsPickup.checked = false;
    deliveryAddress.style.display = 'block';
    getDeliveryLocationBtn.style.display = 'block';
    document.getElementById('deliveryDateSection').style.display = 'block';
  }
});

sameAsPickup.addEventListener('change', () => {
  if(sameAsPickup.checked){
    deliveryAddress.style.display = 'none';
    getDeliveryLocationBtn.style.display = 'none';
    deliveryLocationStatus.textContent = '';
    document.getElementById('deliveryDateSection').style.display = 'none';
  } else {
    deliveryAddress.style.display = 'block';
    getDeliveryLocationBtn.style.display = 'block';
    document.getElementById('deliveryDateSection').style.display = 'block';
  }
});

// ---------------- Geolocation ----------------
// Single Address
getLocationBtn.addEventListener('click', () => {
  if (!navigator.geolocation) {
    locationStatus.textContent = 'Geolocation not supported by your browser';
    return;
  }
  locationStatus.textContent = 'Locating‚Ä¶';
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const { latitude, longitude } = position.coords;
      document.getElementById('singleAddress').value = `Lat: ${latitude}, Lon: ${longitude}`;
      locationStatus.textContent = 'Location captured!';
    },
    () => { locationStatus.textContent = 'Unable to retrieve your location'; }
  );
});

// Pick Up Address
getPickupLocationBtn.addEventListener('click', () => {
  if (!navigator.geolocation) {
    pickupLocationStatus.textContent = 'Geolocation not supported by your browser';
    return;
  }
  pickupLocationStatus.textContent = 'Locating‚Ä¶';
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const { latitude, longitude } = position.coords;
      document.getElementById('pickupAddress').value = `Lat: ${latitude}, Lon: ${longitude}`;
      pickupLocationStatus.textContent = 'Location captured!';
      if(sameAsPickup.checked){
        document.getElementById('deliveryAddress').value = `Lat: ${latitude}, Lon: ${longitude}`;
      }
    },
    () => { pickupLocationStatus.textContent = 'Unable to retrieve your location'; }
  );
});

// Delivery Address
getDeliveryLocationBtn.addEventListener('click', () => {
  if (!navigator.geolocation) {
    deliveryLocationStatus.textContent = 'Geolocation not supported by your browser';
    return;
  }
  deliveryLocationStatus.textContent = 'Locating‚Ä¶';
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const { latitude, longitude } = position.coords;
      document.getElementById('deliveryAddress').value = `Lat: ${latitude}, Lon: ${longitude}`;
      deliveryLocationStatus.textContent = 'Location captured!';
    },
    () => { deliveryLocationStatus.textContent = 'Unable to retrieve your location'; }
  );
});

// ---------------- Form Submission ----------------
function closePopup(){document.getElementById('thankYouPopup').style.display='none';}

function isValidDateTime(dtStr, isPickup){
  if(!dtStr) return false;
  const dt=new Date(dtStr); 
  const day=dt.getDay(); // 0=Sun
  const hour=dt.getHours(); 
  const min=dt.getMinutes();
  if(isPickup){
    if(day>=1&&day<=5){if(hour<8||(hour===8&&min<30)||hour>16||(hour===16&&min>30)) return false;}
    else if(day===6){if(hour<8||(hour===8&&min<30)||hour>11||(hour===11&&min>30)) return false;}
    else return false;
  } else {
    if(day>=1&&day<=5){if(hour<8||(hour===8&&min<30)||hour>16||(hour===16&&min>30)) return false;}
    else if(day===6){if(hour<8||(hour===8&&min<30)||hour>11||(hour===11&&min>30)) return false;}
    else return false;
  }
  return true;
}

document.getElementById('appointmentForm').addEventListener('submit', async function(e){
  e.preventDefault();
  const serviceType=serviceSelect.value;
  const singleDate=document.getElementById('singleDateTime');
  const pickupDate=document.getElementById('pickupDate');
  const deliveryDate=document.getElementById('deliveryDate');

  [singleDate,pickupDate,deliveryDate].forEach(f=>{if(f)f.classList.remove('invalid');});

  if(serviceType==='Pick Up Only'&&!isValidDateTime(singleDate.value,true)){
    alert('Invalid Pick Up date/time.\n‚è∞ Mon‚ÄìFri: 08:30‚Äì16:30\n‚è∞ Sat: 08:30‚Äì11:30\n‚è∞ Sun: Closed');
    singleDate.classList.add('invalid'); return;
  }
  if(serviceType==='Delivery Only'&&!isValidDateTime(singleDate.value,false)){
    alert('Invalid Delivery date/time.\n‚è∞ Mon‚ÄìFri: 08:30‚Äì16:30\n‚è∞ Sat: 08:30‚Äì11:30\n‚è∞ Sun: Closed');
    singleDate.classList.add('invalid'); return;
  }
  if(serviceType==='Pick Up & Delivery'){
    if(!isValidDateTime(pickupDate.value,true)){
      alert('Invalid Pick Up date/time.\n‚è∞ Mon‚ÄìFri: 08:30‚Äì16:30\n‚è∞ Sat: 08:30‚Äì11:30\n‚è∞ Sun: Closed');
      pickupDate.classList.add('invalid'); return;
    }
    if(!isValidDateTime(deliveryDate.value,false)){
      alert('Invalid Delivery date/time.\n‚è∞ Mon‚ÄìFri: 08:30‚Äì16:30\n‚è∞ Sat: 08:30‚Äì11:30\n‚è∞ Sun: Closed');
      deliveryDate.classList.add('invalid'); return;
    }
  }

  const formData=new FormData(this);
  try{
    const response=await fetch(this.action,{method:this.method,body:formData});
    if(response.ok){
      document.getElementById('thankYouPopup').style.display='flex';
      this.reset();
      serviceFields.style.display='none';
      singleAddressSection.style.display='none';
      pickUpDeliverySection.style.display='none';
      document.getElementById('deliveryDateSection').style.display='none';
      [locationStatus,pickupLocationStatus,deliveryLocationStatus].forEach(s=>s.textContent='');
    } else { alert('Error submitting the form. Please try again.'); }
  } catch(err){alert('Error submitting the form. Check your internet connection.'); console.error(err);}
});
</script>
</body>
</html>
